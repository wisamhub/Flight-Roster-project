<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anuti Airlines · Flight View</title>
  <link rel="stylesheet" href="/styles/flight_view.css">
</head>
<body>
  <%- include("partials/navbar.ejs") %>
  <div class="content-wrapper">
    <nav class="nav-container">
      <button class="nav-item active">FLIGHT VIEW</button>
      <button class="nav-item" onclick="window.location.href='/staff/tabular-view'">TABULAR VIEW</button>
      <button class="nav-item" onclick="window.location.href='/staff/extended-view'">EXTENDED VIEW</button>
    </nav>
  <main class="content">
    <h1>Flight View</h1>
    
    <div class="cabin-wrapper">
      <!-- BUSINESS -->
      <section class="cabin cabin-business" aria-label="Business cabin">
        <h2 class="cabin-title">Business</h2>

        <div class="seat-grid">
          <!-- Sol blok -->
          <div class="seat-block">
            <div class="seat-column">
              <div class="seat seat-business" id="1A"></div>
              <div class="seat seat-business" id="2A"></div>
              <div class="seat seat-business" id="3A"></div>
              <div class="seat seat-business" id="4A"></div>
              <div class="seat seat-business" id="5A"></div>
              <div class="seat seat-business" id="6A"></div>
              <div class="seat seat-business" id="7A"></div>
              <div class="seat seat-business" id="8A"></div>
              <div class="seat seat-business" id="9A"></div>
              <div class="seat seat-business" id="10A"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-business" id="1B"></div>
              <div class="seat seat-business" id="2B"></div>
              <div class="seat seat-business" id="3B"></div>
              <div class="seat seat-business" id="4B"></div>
              <div class="seat seat-business" id="5B"></div>
              <div class="seat seat-business" id="6B"></div>
              <div class="seat seat-business" id="7B"></div>
              <div class="seat seat-business" id="8B"></div>
              <div class="seat seat-business" id="9B"></div>
              <div class="seat seat-business" id="10B"></div>
            </div>
          </div>

          <!-- Sağ blok -->
          <div class="seat-block">
            <div class="seat-column">
              <div class="seat seat-business" id="1C"></div>
              <div class="seat seat-business" id="2C"></div>
              <div class="seat seat-business" id="3C"></div>
              <div class="seat seat-business" id="4C"></div>
              <div class="seat seat-business" id="5C"></div>
              <div class="seat seat-business" id="6C"></div>
              <div class="seat seat-business" id="7C"></div>
              <div class="seat seat-business" id="8C"></div>
              <div class="seat seat-business" id="9C"></div>
              <div class="seat seat-business" id="10C"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-business" id="1D"></div>
              <div class="seat seat-business" id="2D"></div>
              <div class="seat seat-business" id="3D"></div>
              <div class="seat seat-business" id="4D"></div>
              <div class="seat seat-business" id="5D"></div>
              <div class="seat seat-business" id="6D"></div>
              <div class="seat seat-business" id="7D"></div>
              <div class="seat seat-business" id="8D"></div>
              <div class="seat seat-business" id="9D"></div>
              <div class="seat seat-business" id="10D"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- BASIC -->
      <section class="cabin cabin-basic" aria-label="Basic cabin">
        <h2 class="cabin-title">Basic</h2>

        <div class="seat-grid">
          <!-- Sol blok -->
          <div class="seat-block">
            <div class="seat-column">
              <div class="seat seat-basic" id="11A"></div>
              <div class="seat seat-basic" id="12A"></div>
              <div class="seat seat-basic" id="13A"></div>
              <div class="seat seat-basic" id="14A"></div>
              <div class="seat seat-basic" id="15A"></div>
              <div class="seat seat-basic" id="16A"></div>
              <div class="seat seat-basic" id="17A"></div>
              <div class="seat seat-basic" id="18A"></div>
              <div class="seat seat-basic" id="19A"></div>
              <div class="seat seat-basic" id="20A"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-basic" id="11B"></div>
              <div class="seat seat-basic" id="12B"></div>
              <div class="seat seat-basic" id="13B"></div>
              <div class="seat seat-basic" id="14B"></div>
              <div class="seat seat-basic" id="15B"></div>
              <div class="seat seat-basic" id="16B"></div>
              <div class="seat seat-basic" id="17B"></div>
              <div class="seat seat-basic" id="18B"></div>
              <div class="seat seat-basic" id="19B"></div>
              <div class="seat seat-basic" id="20B"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-basic" id="11C"></div>
              <div class="seat seat-basic" id="12C"></div>
              <div class="seat seat-basic" id="13C"></div>
              <div class="seat seat-basic" id="14C"></div>
              <div class="seat seat-basic" id="15C"></div>
              <div class="seat seat-basic" id="16C"></div>
              <div class="seat seat-basic" id="17C"></div>
              <div class="seat seat-basic" id="18C"></div>
              <div class="seat seat-basic" id="19C"></div>
              <div class="seat seat-basic" id="20C"></div>
            </div>
          </div>

          <!-- Sağ blok -->
          <div class="seat-block">
            <div class="seat-column">
              <div class="seat seat-basic" id="11D"></div>
              <div class="seat seat-basic" id="12D"></div>
              <div class="seat seat-basic" id="13D"></div>
              <div class="seat seat-basic" id="14D"></div>
              <div class="seat seat-basic" id="15D"></div>
              <div class="seat seat-basic" id="16D"></div>
              <div class="seat seat-basic" id="17D"></div>
              <div class="seat seat-basic" id="18D"></div>
              <div class="seat seat-basic" id="19D"></div>
              <div class="seat seat-basic" id="20D"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-basic" id="11E"></div>
              <div class="seat seat-basic" id="12E"></div>
              <div class="seat seat-basic" id="13E"></div>
              <div class="seat seat-basic" id="14E"></div>
              <div class="seat seat-basic" id="15E"></div>
              <div class="seat seat-basic" id="16E"></div>
              <div class="seat seat-basic" id="17E"></div>
              <div class="seat seat-basic" id="18E"></div>
              <div class="seat seat-basic" id="19E"></div>
              <div class="seat seat-basic" id="20E"></div>
            </div>
            <div class="seat-column">
              <div class="seat seat-basic" id="11F"></div>
              <div class="seat seat-basic" id="12F"></div>
              <div class="seat seat-basic" id="13F"></div>
              <div class="seat seat-basic" id="14F"></div>
              <div class="seat seat-basic" id="15F"></div>
              <div class="seat seat-basic" id="16F"></div>
              <div class="seat seat-basic" id="17F"></div>
              <div class="seat seat-basic" id="18F"></div>
              <div class="seat seat-basic" id="19F"></div>
              <div class="seat seat-basic" id="20F"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="legend">
      <span><div class="legend-box legend-free"></div> Free</span>
      <span><div class="legend-box legend-taken"></div> Taken</span>
    </div>

    <div class="seat-tooltip" id="seat-tooltip">
      <div class="seat-tooltip-row">
        <span>
          <span class="tooltip-label">Name:</span>
          <span class="tooltip-value" id="tooltip-name"></span>
        </span>
        <span>
          <span class="tooltip-label">Gender:</span>
          <span class="tooltip-value" id="tooltip-gender"></span>
        </span>
      </div>
      <div class="seat-tooltip-row">
        <span>
          <span class="tooltip-label">Nationality:</span>
          <span class="tooltip-value" id="tooltip-nationality"></span>
        </span>
        <span>
          <span class="tooltip-label">Age:</span>
          <span class="tooltip-value" id="tooltip-age"></span>
        </span>
      </div>
    </div>
</main>


<!-- this script is static has no EJS influence -->
  <script> 
    const tooltip = document.getElementById("seat-tooltip");
    const tooltipName = document.getElementById("tooltip-name");
    const tooltipGender = document.getElementById("tooltip-gender");
    const tooltipNationality = document.getElementById("tooltip-nationality");
    const tooltipAge = document.getElementById("tooltip-age");
    const container = document.querySelector(".content");

    // seatCode üretici: columns = kolon sayısı, startRow = hangi satırdan başlasın
    function setupSeatCodes(selector, columns, startRow) {
      const seats = document.querySelectorAll(selector);
      const rows = 10;
      seats.forEach((seat, index) => {
        const colIndex = Math.floor(index / rows); // 0..columns-1
        const rowIndex = index % rows;            // 0..9
        const letter = String.fromCharCode(65 + colIndex); // A,B,C...
        const code = (startRow + rowIndex) + letter;       // 1A, 11C, vb.
        seat.textContent = code;
        seat.dataset.seat = code;
      });
    }

    // Business: 4 kolon, 1–10
    setupSeatCodes(".seat-business", 4, 1);
    // Basic: 6 kolon, 11–20 (Business’ın devamı)
    setupSeatCodes(".seat-basic", 6, 11);

    // DB'den veri bağlamak için örnek (gerçek veriyi siz dolduracaksınız):

    // this will add details and make the hover functional
    function addDetails(seatID, name, gender, nationality, age) {
       const sID = document.getElementById(seatID);
      sID.dataset.name = name;
      sID.dataset.gender = gender;
      sID.dataset.nationality = nationality;
      sID.dataset.age = age;
      sID.classList.add("legend-taken");
    
      sID.addEventListener("mouseenter", () => showTooltip(sID));
      sID.addEventListener("mouseleave", hideTooltip);
      sID.addEventListener("focus", () => showTooltip(sID));
      sID.addEventListener("blur", hideTooltip);
   
    }
    //addDetails("6C","wissam the gigachad","Male","Turkish","34");
    //addDetails("20F","abdelrahman","Male","Turkish","34");
    //addDetails("12A","mustafa","Male","Turkish","34");
    

    function showTooltip(seat) {
      const name = seat.dataset.name || "";
      const gender = seat.dataset.gender || "";
      const nationality = seat.dataset.nationality || "";
      const age = seat.dataset.age || "";

      tooltipName.textContent = name;
      tooltipGender.textContent = gender;
      tooltipNationality.textContent = nationality;
      tooltipAge.textContent = age;

      const seatRect = seat.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();

      const centerX = seatRect.left - containerRect.left + seatRect.width / 2;
      const top = seatRect.top - containerRect.top;

      tooltip.style.left = centerX + "px";
      tooltip.style.top = top + "px";
      tooltip.style.display = "block";
    }

    function hideTooltip() {
      tooltip.style.display = "none";
    }
  </script>

<!-- this script will add people from database into the seats -->
  <script>
    function calculateAge(dateString) {
      const today = new Date();
      const birthDate = new Date(dateString);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      const dayDiff = today.getDate() - birthDate.getDate();
      if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
          age--;
      }
      return age; 
  }

    // this will show an error but it is correct VSC just thinks it does not belong here
    const passengers = <%- JSON.stringify(passengers) %>;
    passengers.forEach(p => {
    const pSeatID = p.seat_number;
    const pName = `${p.first_name} ${p.last_name}`;
    const pGender = p.gender;
    const pNationality = p.nationality;
    const pAge = calculateAge(p.birth_date);


    addDetails(pSeatID, pName, pGender, pNationality, pAge);
    });
  </script>

</body>
</html>
