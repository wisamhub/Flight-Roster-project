<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Information - Responsive</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Corben:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/extended_view.css">
</head>
<body>
    <%- include("partials/navbar.ejs") %>
    <div class="main-app-container">

        <nav class="nav-container">
            <button class="nav-item" onclick="window.location.href='/staff/flight-view'">
                FLIGHT VIEW
            </button>
            <button class="nav-item" onclick="window.location.href='/staff/tabular-view'">
                TABULAR VIEW
            </button>
            <button class="nav-item active">
                EXTENDED VIEW
            </button>
        </nav>

        <main class="content-area">

            <section class="info-section">
                <div class="section-header">
                    <h2>FLIGHT INFORMATION</h2>
                </div>
                <div class="responsive-grid grid-header-row">
                    <div class="grid-cell header-cell">FLIGHT NUMBER</div>
                    <div class="grid-cell header-cell">GATE</div>
                    <div class="grid-cell header-cell">DEPARTURE AIRPORT</div>
                    <div class="grid-cell header-cell">DEPARTURE TIME</div>
                    <div class="grid-cell header-cell">ARRIVAL AIRPORT</div>
                    <div class="grid-cell header-cell">ARRIVAL TIME</div>
                </div>
                <div class="responsive-grid data-row">
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.flight_number : 'N/A' %></div>
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.gate : 'TBD' %></div>
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.dept_airport : 'N/A' %></div>
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.dept_time : 'N/A' %></div>
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.arrival_airport : 'N/A' %></div> 
                    <div class="grid-cell data-cell"><%= flightInfo ? flightInfo.arrival_time : 'N/A' %></div>
                </div>
                
            </section>

            <section class="info-section">
                <div class="section-header">
                    <h2>CABIN CREW</h2>
                </div>
                <div class="responsive-grid grid-header-row">
                    <div class="grid-cell header-cell">NAME</div>
                    <div class="grid-cell header-cell">GENDER</div>
                    <div class="grid-cell header-cell">RANK</div>
                    <div class="grid-cell header-cell">NATIONALITY</div>
                    <div class="grid-cell header-cell">LANGUAGE</div>
                    <div class="grid-cell header-cell">AGE</div>
                    <%function calculateAge(dateString) {
                        const today = new Date();
                        const birthDate = new Date(dateString);

                        let age = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();
                        const dayDiff = today.getDate() - birthDate.getDate();

                        // If the persons birthday hasn't happened yet
                        if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
                            age--;
                        }
                        return age; 
                    } %>
                </div>
                <div class="responsive-grid data-row">
                    <% if (staff.cabinCrew && staff.cabinCrew.length > 0) { %>
                        <% staff.cabinCrew.forEach(function(c){ %>
                    <div class="grid-cell data-cell"><%= c.first_name || 'N/A' %> <%= c.last_name || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= c.gender || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= c.rank || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= c.nationality || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= c.speaks || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= c.birth_date ? calculateAge(c.birth_date) : 'N/A' %></div>
                     <% })} %>
                </div>
            </section>

            <section class="info-section">
                <div class="section-header">
                    <h2>PILOTS</h2>
                </div>
                <div class="responsive-grid grid-header-row compact-text">
                    <div class="grid-cell header-cell">NAME</div>
                    <div class="grid-cell header-cell">GENDER</div>
                    <div class="grid-cell header-cell">RANK</div>
                    <div class="grid-cell header-cell">NATIONALITY</div>
                    <div class="grid-cell header-cell">LANG</div>
                    <div class="grid-cell header-cell">AGE</div>
                </div>
                <div class="responsive-grid data-row">
                    <% if (staff.pilot && staff.pilot.length > 0) { %>
                         <% staff.pilot.forEach(function(p) { %>
                    <div class="grid-cell data-cell"><%= p.first_name || 'N/A' %> <%= p.last_name || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= p.gender || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= p.rank || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= p.nationality || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= p.speaks || 'N/A' %></div>
                     <div class="grid-cell data-cell"><%= p.birth_date ? calculateAge(p.birth_date) : 'N/A' %></div>
                     <% })} %>
                </div>
            </section>

            <section class="info-section">
                <div class="section-header">
                    <h2>CHEFS</h2>
                </div>
                <div class="responsive-grid-chef grid-header-row compact-text">
                    <div class="grid-cell header-cell" >NAME</div>
                    <div class="grid-cell header-cell" id="cook_title">CAN COOK</div>
                </div>
                <div class="responsive-grid-chef data-row">
                    <% if (staff.chef && staff.chef.length > 0) { %>
                        <% staff.chef.forEach(function(c){ %>
                    <div class="grid-cell data-cell"><%= c.first_name || 'N/A' %> <%= c.last_name || 'N/A' %></div>
                     <div class="grid-cell data-cell" id="cook_description"><%= c.dishes || 'N/A' %></div>
                    <% })} %>
                </div>
            </section>

            <section class="info-section">
                <div class="section-header">
                    <h2>PASSENGERS</h2>
                </div>
                <div class="responsive-grid grid-header-row">
                    <div class="grid-cell header-cell">PASSPORT NUMBER</div>
                    <div class="grid-cell header-cell">NAME</div>
                    <div class="grid-cell header-cell">AGE</div>
                    <div class="grid-cell header-cell">NATIONALITY</div>
                    <div class="grid-cell header-cell">GENDER</div>
                    <div class="grid-cell header-cell">Allergens/Disabilities</div>
                </div>
                <div class="responsive-grid data-row">
                    <% if (passengers && passengers.length > 0) { %>
                        
                            <% passengers.forEach(function(p) { %>
                        <div class="grid-cell data-cell"><%= p.passport_number || 'N/A' %></div>
                        <div class="grid-cell data-cell"><%= p.first_name || 'N/A' %> <%= p.last_name || 'N/A' %></div>
                        <div class="grid-cell data-cell"><%= p.birth_date ? calculateAge(p.birth_date) : 'N/A' %></div>
                        <div class="grid-cell data-cell"><%= p.nationality || 'N/A' %></div>
                        <div class="grid-cell data-cell"><%= p.gender || 'N/A' %></div>
                        <div class="grid-cell data-cell"><%= p.has_allergy || 'N/A' %> / <%= p.disability_assistance || 'N/A' %></div>
                    <% }) %>
                    <% } else { %>
                        <div class="grid-cell data-cell" style="grid-column: span 3;">No passengers found</div>
                    <% } %>
                </div>
            </section>

            <section class="info-section">
                <div class="section-header">
                    <h2>AIRCRAFT</h2>
                </div>
                <div class="responsive-grid grid-header-row">
                    <div class="grid-cell header-cell">AIRCRAFT NAME</div>
                    <div class="grid-cell header-cell">PILOT CAPACITY</div>
                    <div class="grid-cell header-cell">CABIN CREW CAPACITY</div>
                    <div class="grid-cell header-cell">PASSENGER CAPACITY (TOTAL/ECONOMY/BUSINESS)</div>
                    <div class="grid-cell header-cell">ECONOMY/BUSINESS LAYOUT</div>
                    <div class="grid-cell header-cell">MAX RANGE</div>
                </div>
                <div class="responsive-grid data-row">
                    <% let aircraft_name;
                        if(aircraft && aircraft.family_name && aircraft.variant_name){
                            if(aircraft.variant_name.startsWith('-')){
                                aircraft_name = aircraft.family_name + aircraft.variant_name;
                            }
                            else{
                                aircraft_name = aircraft.variant_name;
                            }
                    } %>
                    <div class="grid-cell data-cell"><%= aircraft_name ? aircraft_name : 'N/A' %></div>
                    <div class="grid-cell data-cell"><%= aircraft.pilot_capacity ? aircraft.pilot_capacity : 'N/A' %></div>
                    <div class="grid-cell data-cell"><%= aircraft.cabin_crew_capacity ? aircraft.cabin_crew_capacity : 'N/A' %></div>
                    <div class="grid-cell data-cell"><% if(aircraft.economy_passenger_capacity && aircraft.business_passenger_capacity){ %> <%= aircraft.economy_passenger_capacity + aircraft.business_passenger_capacity %> / <%= aircraft.economy_passenger_capacity %> / <%= aircraft.business_passenger_capacity %> <% } else{ %> N/A <% } %></div>
                    <div class="grid-cell data-cell"><% if(aircraft.economy_passenger_layout && aircraft.business_passenger_layout){ %> <%= aircraft.economy_passenger_layout %> / <%= aircraft.business_passenger_layout %> <% } else{ %> N/A / N/A<% } %></div>
                    <div class="grid-cell data-cell"><%= aircraft.business_passenger_layout ? aircraft.max_range_km : 'N/A' %></div>
                </div>
            </section>

        </main>
    </div>
</body>
</html>